---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getEntriesForTag, getTagIndex } from '../../lib/tagIndex';
import { formatYmd } from '../../lib/dates';

export async function getStaticPaths() {
	const tags = await getTagIndex();
	return tags.map((t) => ({ params: { tag: t.slug }, props: { tag: t } }));
}

const { tag } = Astro.props as { tag: { slug: string; label: string } };
const { posts, works } = await getEntriesForTag(tag.slug);
---

<BaseLayout title={`Tag: ${tag.label}`} description={`Posts and works tagged “${tag.label}”.`}>
	<h1 class="text-2xl font-bold tracking-tight">Tag: {tag.label}</h1>

	{posts.length ? (
		<section class="mt-8">
			<h2 class="text-lg font-semibold">Posts</h2>
			<ul class="mt-4 space-y-3">
				{posts.map((p) => (
					<li class="rounded-lg border border-border bg-card p-4">
						<a href={`/posts/${p.slug}`} class="no-underline hover:underline">
							<span class="font-medium">{p.data.title}</span>
						</a>
						<div class="mt-1 text-sm text-muted-foreground">{formatYmd(p.data.pubDate)}</div>
					</li>
				))}
			</ul>
		</section>
	) : null}

	{works.length ? (
		<section class="mt-10">
			<h2 class="text-lg font-semibold">Works</h2>
			<ul class="mt-4 space-y-3">
				{works.map((w) => (
					<li class="rounded-lg border border-border bg-card p-4">
						<a href={`/works/${w.slug}`} class="no-underline hover:underline">
							<span class="font-medium">{w.data.title}</span>
						</a>
						<div class="mt-1 text-sm text-muted-foreground">{formatYmd(w.data.date)}</div>
					</li>
				))}
			</ul>
		</section>
	) : null}

	{!posts.length && !works.length ? <p class="mt-8 text-muted-foreground">Nothing here yet.</p> : null}
</BaseLayout>
