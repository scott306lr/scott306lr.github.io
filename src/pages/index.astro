---
import BaseLayout from '../layouts/BaseLayout.astro';
import { Image } from 'astro:assets';
import { getCollection } from 'astro:content';
import { isNotDraft, sortByDateDesc } from '../lib/content';
import { formatYmd } from '../lib/dates';
import PostCard from '../components/PostCard.astro';
import ProjectCard from '../components/ProjectCard.astro';
import profileImage from '../assets/profile-placeholder.png';

import publicationsData from '../../data/publications.json';
import eventsData from '../../data/events.json';
import {
	sortByDateStringDesc,
	validateEvents,
	validatePublications,
} from '../lib/academicData';

const validatedPublications = validatePublications(publicationsData);
const validatedEvents = validateEvents(eventsData);

const posts = (await getCollection('posts')).filter(isNotDraft).sort(sortByDateDesc).slice(0, 6);
const projects = (await getCollection('projects'))
	.filter(isNotDraft)
	.filter((w) => w.data.featured)
	.sort(sortByDateDesc)
	.slice(0, 6);

const publications = validatedPublications.sort(sortByDateStringDesc).slice(0, 4);

const events = validatedEvents.sort(sortByDateStringDesc).slice(0, 4);
---

<BaseLayout
		title="Pei-Shuo Wang — Projects & Research"
		description="Projects, publications, and notes by Pei-Shuo Wang."

>
	<section class="mb-10">
		<div class="flex flex-col gap-6 sm:flex-row sm:items-center sm:justify-between">
			<div>
				<h1 class="text-3xl font-semibold tracking-tight text-foreground">Hi, I’m Pei-Shuo.</h1>
				<p class="mt-3 max-w-prose text-muted-foreground">
					I’m a Master’s student at National Yang Ming Chiao Tung University (NYCU), focusing on efficient LLM inference and model compression.
				</p>
				<p class="mt-3 text-sm text-muted-foreground">
					<a href="/about" class="text-foreground underline underline-offset-4">About</a>
					<span class="mx-2">·</span>
					<a href="mailto:scott306lr@gmail.com" class="text-foreground underline underline-offset-4">Email</a>
					<span class="mx-2">·</span>
					<a href="https://github.com/scott306lr" class="text-foreground underline underline-offset-4">GitHub</a>
					<span class="mx-2">·</span>
					<a href="https://www.linkedin.com/in/pei-shuo-wang-557754229" class="text-foreground underline underline-offset-4">LinkedIn</a>
				</p>
			</div>
			<Image
				src={profileImage}
				alt="Portrait of Pei-Shuo Wang"
				width={144}
				height={144}
				format="webp"
				quality={70}
				loading="eager"
				class="h-28 w-28 rounded-full border border-border object-cover shadow-sm"
			/>
		</div>
	</section>

	<section class="mb-12">
		<div class="mb-4 flex items-center justify-between">
			<h2 class="text-lg font-semibold">Latest posts</h2>
			<a href="/posts" class="text-sm text-muted-foreground no-underline hover:text-foreground">All posts</a>
		</div>
		<div class="grid gap-4">
			{posts.map((post) => (
				<PostCard post={post} />
			))}
		</div>
	</section>

	<section class="mb-12">
		<div class="mb-4 flex items-center justify-between">
			<h2 class="text-lg font-semibold">Featured projects</h2>
			<a href="/projects" class="text-sm text-muted-foreground no-underline hover:text-foreground">All projects</a>
		</div>
		<div class="grid gap-4">
			{projects.map((project) => (
				<ProjectCard project={project} />
			))}
		</div>
	</section>

	<section class="mb-12">
		<div class="mb-4 flex items-center justify-between">
			<h2 class="text-lg font-semibold">Publications</h2>
			<a href="/about" class="text-sm text-muted-foreground no-underline hover:text-foreground">All</a>
		</div>
		<ul class="list-disc space-y-2 pl-5 text-sm text-foreground">
			{publications.map((p) => (
				<li>
					<span class="font-medium">{p.title}</span>
					<span class="text-muted-foreground">
						{p.authors?.length ? (
							<>
								{' — '}
								{p.authors.map((author, i) => (
									<>
										{i ? ', ' : null}
										{author === 'Pei-Shuo Wang' ? <span class="font-semibold text-foreground">{author}</span> : author}
									</>
								))}
							</>
						) : null}
						{p.venue ? ` · ${p.venue}` : ''}
						{` · ${formatYmd(new Date(p.date))}`}
					</span>
					{p.links?.paper ? (
						<a href={p.links.paper} class="ml-2 text-foreground underline underline-offset-4">
							Paper
						</a>
					) : null}
				</li>
			))}
		</ul>
	</section>

	<section>
		<div class="mb-4 flex items-center justify-between">
			<h2 class="text-lg font-semibold">Recent events</h2>
			<a href="/about" class="text-sm text-muted-foreground no-underline hover:text-foreground">All</a>
		</div>
		{events.length ? (
			<ul class="list-disc space-y-2 pl-5 text-sm text-foreground">
				{events.map((e) => (
					<li>
						<span class="font-medium">{e.title}</span>
						<span class="text-muted-foreground">
							{e.location ? ` — ${e.location}` : ''}
							{`${e.location ? '' : ' —'} ${formatYmd(new Date(e.date))}`}
						</span>
						{e.links?.url ? (
							<a href={e.links.url} class="ml-2 text-foreground underline underline-offset-4">
								Details
							</a>
						) : null}
					</li>
				))}
			</ul>
		) : (
			<p class="text-sm text-muted-foreground">No events listed yet.</p>
		)}
	</section>
</BaseLayout>
