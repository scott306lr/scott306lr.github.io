---
import BaseLayout from '../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';
import { isNotDraft, sortByDateDesc } from '../lib/content';
import { formatYmd } from '../lib/dates';

const posts = (await getCollection('posts')).filter(isNotDraft).sort(sortByDateDesc).slice(0, 6);
const works = (await getCollection('works'))
	.filter(isNotDraft)
	.filter((w) => w.data.featured)
	.sort(sortByDateDesc)
	.slice(0, 6);
---

<BaseLayout
	title="Scott — Blog & Works"
	description="Works and thoughts by Scott."
>
	<section class="mb-10">
		<h1 class="text-3xl font-semibold tracking-tight text-foreground">Hi, I’m Scott.</h1>
		<p class="mt-3 max-w-prose text-muted-foreground">
			I post my works and thoughts here. The site is intentionally minimal: fast, readable, and built for developers.
		</p>
	</section>

	<section class="mb-12">
		<div class="mb-4 flex items-center justify-between">
			<h2 class="text-lg font-semibold">Latest posts</h2>
			<a href="/posts" class="text-sm text-muted-foreground no-underline hover:text-foreground">All posts</a>
		</div>
		<div class="grid gap-4">
			{posts.map((post) => (
				<a
					href={`/posts/${post.slug}`}
					class="rounded-lg border bg-card p-4 no-underline transition hover:bg-accent"
				>
					<div class="flex items-baseline justify-between gap-4">
						<span class="font-medium text-card-foreground">{post.data.title}</span>
						<span class="text-xs text-muted-foreground">{formatYmd(post.data.pubDate)}</span>
					</div>
					<p class="mt-2 text-sm text-muted-foreground">{post.data.description}</p>
				</a>
			))}
		</div>
	</section>

	<section>
		<div class="mb-4 flex items-center justify-between">
			<h2 class="text-lg font-semibold">Featured works</h2>
			<a href="/works" class="text-sm text-muted-foreground no-underline hover:text-foreground">All works</a>
		</div>
		<div class="grid gap-4">
			{works.map((work) => (
				<a
					href={`/works/${work.slug}`}
					class="rounded-lg border bg-card p-4 no-underline transition hover:bg-accent"
				>
					<div class="flex items-baseline justify-between gap-4">
						<span class="font-medium text-card-foreground">{work.data.title}</span>
						<span class="text-xs text-muted-foreground">{formatYmd(work.data.date)}</span>
					</div>
					<p class="mt-2 text-sm text-muted-foreground">{work.data.summary}</p>
				</a>
			))}
		</div>
	</section>
</BaseLayout>
