---
const buttonClass =
	'inline-flex items-center gap-2 rounded-md border border-zinc-200 bg-white px-3 py-1.5 text-sm text-zinc-800 shadow-sm hover:bg-zinc-50 dark:border-zinc-800 dark:bg-zinc-900 dark:text-zinc-100 dark:hover:bg-zinc-800';
---

<div class="flex items-center gap-2">
	<button id="theme-toggle" type="button" class={buttonClass}>
		<span class="font-medium">Theme</span>
		<span id="theme-label" class="text-zinc-500 dark:text-zinc-400">system</span>
	</button>
</div>

<script>
	const THEME_KEY = 'theme';
	const options = ['system', 'light', 'dark'];

	function getPreferredTheme() {
		const stored = localStorage.getItem(THEME_KEY);
		return stored && options.includes(stored) ? stored : 'system';
	}

	function applyTheme(theme) {
		const isDark =
			theme === 'dark' ||
			(theme === 'system' && window.matchMedia('(prefers-color-scheme: dark)').matches);
		document.documentElement.classList.toggle('dark', isDark);
	}

	function setLabel(theme) {
		const el = document.getElementById('theme-label');
		if (el) el.textContent = theme;
	}

	const button = document.getElementById('theme-toggle');
	let current = getPreferredTheme();
	applyTheme(current);
	setLabel(current);

	button?.addEventListener('click', () => {
		const next = options[(options.indexOf(current) + 1) % options.length];
		current = next;
		localStorage.setItem(THEME_KEY, current);
		applyTheme(current);
		setLabel(current);
	});

	window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', () => {
		if (getPreferredTheme() === 'system') applyTheme('system');
	});
</script>
